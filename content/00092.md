---
title: Igoの辞書にはてなキーワードを追加する
categories: ["Programming", "Java", "net", "reduls", "igo"]
date: 2011-09-04T06:58:21+09:00
updated: 2011-09-04T06:58:21+09:00
---

[以前紹介した][1]Java製の形態素解析ライブラリIgoに辞書を追加してみる。というか辞書の追加方法はMecabとほぼ同じ。

CSVに変換するところまではMecabにはてなキーワードの辞書を追加する方法と全く同じ作業を行う。[この記事][2]参照。

スクリプト(createDict.py)を再掲させていただくと、

    # -*- encoding: utf-8 -*-                                                                                                        
    import sys
    import re
    
    #数字四桁が入ったキーワードは役に立ちませんので検出して飛ばします。                                                              
    year = re.compile("[0-9]{4}")
    
    #驚くべきことにはてなキーワードには%00というキーワードがありますが、                                                             
    #これがcsvとして提供されているダンプではヌル文字になっているのでシステム制御文字を非許可にします。                               
    ng = [chr(i) for i in range(0,32)]
    
    def main():
    	for x in sys.stdin:
    		if re.search(year,x):
    			continue #日付スキップ                                                                                   
    		k = x.split("\t")[1].strip()
    		if len(k) < 2:
    			continue #一文字スキップ                                                                                 
    		for word in ng:
    			if word in k:
                                    continue #システム制御文字スキップ                                                               
    		k = k.lower() #MeCabはケースセンシティブなので小文字に統一して辞書作成                                           
    		cost = int(max(-32768, -400 * len(k)**1.5)) #コストについては後述                                                
    		print "%s,0,0,%s,名詞,一般,*,*,*,*,%s,*,*,はてなキーワード," % (k,cost,k) #0については後述                       
    if __name__ == '__main__':
      main()

次のスクリプトを叩けば辞書CSVファイルができる

    #!/bin/sh                                                                                                                        
    wget http://d.hatena.ne.jp/images/keyword/keywordlist_furigana.csv -O hatena.txt
    nkf -Ew hatena.txt | python createDict.py | nkf -e > (mecab-ipadic-2.7.0-20070801ディレクトリパス)/hatenakeyword.csv

あとは前回同様

    import net.reduls.igo.bin.BuildDic;
    
    public class BuildDict {
        public static void main(String[] _args) {
            String[] args = { "ipadic", "(mecab-ipadic-2.7.0-20070801ディレクトリパス)", "EUC-JP" };
            BuildDic.main(args);
        }
    }

を実行すればipadicディレクトリに辞書が作成される。

のだが、Igoは[この記事][3]で突っ込まれているようにCSVのパースを","の位置で判断していて、CSV要素中にカンマが含まれているとPARSE ERRORになる。はてなキーワードにもそういう要素があるのでエラーが発生する。該当行を削除するのでもいいが、辞書のメンテナンスが面倒なので、Igoのパース処理を直した(正規表現でパースした。遅くなるけど辞書作成のときだけだし、いいや)。

パッチをあてたjarは[こちら][4]からDL。Mavenから使う場合は前の記事の通り設定して`<version>`を`0.4.3-patched`にする。


このjarで作った辞書で、

        public static void main(String[] args) throws Exception {
            List<Morpheme> ret = new Tagger("ipadic")
                    .parse("自分のツイートや、リツイートされたツイート、自分宛のツイート、新しいフォロワーといった自分に関連する動きがリアルタイムで表示される。");
            for (Morpheme m : ret) {
                System.out.printf("%s|%s|%s%n", m.surface, m.feature, m.start);
            }
        }

を実行すると、

    自分|名詞,一般,*,*,*,*,自分,*,*,はてなキーワード,|0
    の|助詞,連体化,*,*,*,*,の,ノ,ノ|2
    ツイート|名詞,一般,*,*,*,*,ツイート,*,*,はてなキーワード,|3
    や|助詞,並立助詞,*,*,*,*,や,ヤ,ヤ|7
    、|記号,読点,*,*,*,*,、,、,、|8
    リツイート|名詞,一般,*,*,*,*,リツイート,*,*,はてなキーワード,|9
    さ|動詞,自立,*,*,サ変・スル,未然レル接続,する,サ,サ|14
    れ|動詞,接尾,*,*,一段,連用形,れる,レ,レ|15
    た|助動詞,*,*,*,特殊・タ,基本形,た,タ,タ|16
    ツイート|名詞,一般,*,*,*,*,ツイート,*,*,はてなキーワード,|17
    、|記号,読点,*,*,*,*,、,、,、|21
    自分|名詞,一般,*,*,*,*,自分,*,*,はてなキーワード,|22
    宛|名詞,一般,*,*,*,*,宛,アテ,アテ|24
    の|助詞,連体化,*,*,*,*,の,ノ,ノ|25
    ツイート|名詞,一般,*,*,*,*,ツイート,*,*,はてなキーワード,|26
    、|記号,読点,*,*,*,*,、,、,、|30
    新しい|形容詞,自立,*,*,形容詞・イ段,基本形,新しい,アタラシイ,アタラシイ|31
    フォロワー|名詞,一般,*,*,*,*,フォロワー,*,*,はてなキーワード,|34
    といった|助詞,格助詞,連語,*,*,*,といった,トイッタ,トイッタ|39
    自分|名詞,一般,*,*,*,*,自分,*,*,はてなキーワード,|43
    に|助詞,格助詞,一般,*,*,*,に,ニ,ニ|45
    関連|名詞,サ変接続,*,*,*,*,関連,カンレン,カンレン|46
    する|動詞,自立,*,*,サ変・スル,基本形,する,スル,スル|48
    動き|名詞,一般,*,*,*,*,動き,ウゴキ,ウゴキ|50
    が|助詞,格助詞,一般,*,*,*,が,ガ,ガ|52
    リアルタイム|名詞,一般,*,*,*,*,リアルタイム,*,*,はてなキーワード,|53
    で|接続詞,*,*,*,*,*,で,デ,デ|59
    表示|名詞,サ変接続,*,*,*,*,表示,ヒョウジ,ヒョージ|60
    さ|動詞,自立,*,*,サ変・スル,未然レル接続,する,サ,サ|62
    れる|動詞,接尾,*,*,一段,基本形,れる,レル,レル|63
    。|記号,句点,*,*,*,*,。,。,。|65

って感じ。Javaでちょろっとできるのが便利

  [1]: http://blog.ik.am/entry/view/id/66/%E3%81%BB%E3%81%BCMecab%E4%BA%92%E6%8F%9B%E3%81%AAJava%E5%AE%9F%E8%A3%85%E5%BD%A2%E6%85%8B%E7%B4%A0%E8%A7%A3%E6%9E%90%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AAIgo%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B/
  [2]: http://d.hatena.ne.jp/code46/20090531/p1
  [3]: http://www.mwsoft.jp/programming/munou/igo_install.html
  [4]: http://dl.dropbox.com/u/342817/maven/releases/net/reduls/igo/igo/0.4.3-patched/igo-0.4.3-patched.jar
